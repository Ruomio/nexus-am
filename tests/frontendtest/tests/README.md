# 前端测试（汇编/内联汇编）总览

本目录包含一组以 RISC‑V 汇编或内联汇编为主的微基准，聚焦前端相关能力：
- 取指能力与取指带宽（含 2‑fetch、多基本块同线取指、取指碎片化）
- 分支预测（方向：BHT/PHT/TAGE/GShare；目标：BTB、RAS）
- 多分支同基本块打包与前端分支处理宽度
- 少量与前端相关但不以分支为核心的宽度/延迟测试（标注为“非分支”）

公共宏定义见 `tests/frontendtest/tests/common.h`：
- `ONE`：各测试内部定义的一组指令微序列
- `FIVE/TEN/FIFTY/HUNDRED/THOUSAND/...`：通过宏展开重复插入 `ONE`
- `__LOOP_COUNT`：部分测试重复次数的默认常量

下列条目按“与前端分支预测的相关性”进行分组说明。

## 强相关：前端取指/分支预测
- `2fetch.c`
  - 目的：在同一 I$ 行内构造两个 3 指令基本块 A/B，A 跳到 B，B 条件跳回 A，观察“2‑fetch/多基本块同拍取指”与 BTB 命中情况。
  - 关注：BTB 对 `j`/`bnez` 目标供给；同线双块是否单拍取回；跨块重定向气泡。

- `brsimple.c`
  - 目的：单一循环分支（`blt t0, %1, 1b`），方向高度偏置，作为方向预测器基线。
  - 关注：BHT/PHT 冷启动到稳态的收敛；误预测尾数。

- `brnum.c`
  - 内容：三个子测试，构造“一次取回含多条件分支”的场景；包含始终 T/交替/阶段性变化等模式。
  - 关注：前端对“同基本块多分支”的处理、方向预测在多分支密度下的稳定性与别名。

- `brnum2.c`、`brnum3.c`、`brnum2_uftb.c`
  - 目的：进一步提高每个基本块内的分支数量，并通过 `dummy_inst`/压缩指令控制布局（32B/64B 对齐），探查“每块可支持的分支数（numBr）”“fetchBlock 大小”“FTQ/BTB 更新与别名”。
  - 关注：多分支同块下的预测与更新上限、被挤出/覆盖的行为、别名与对齐对命中率的影响。

- `brwidth.c`
  - 目的：密集分支（多数 NT），用于压力测试“前端对分支的处理宽度/吞吐”。
  - 关注：分支解码/预测/更新通路的饱和点；非准确性而是“宽度”。

- `fetchfrag.c`
  - 目的：在 32B 内混合压缩指令与多分支（前三个 NT，最后一个 T），测试“取指碎片化 + 多分支同块”的前端能力。
  - 关注：I$ 行内边界、PC 对齐、压缩指令对分支边界的影响；BTB 命中与多分支更新。

- `rastest.c`、`ras_recursive.c`
  - 目的：验证返回地址栈（RAS）在简单调用/递归场景的 push/pop 正确性与深度管理。
  - 关注：ret 目标命中率；异常/冲刷回滚后一致性；深度溢出/回退行为。

- `tage1.c`、`tage2.c`、`tage3.c`、`tage4.c`
  - 目的：构造交替、按计数器位选择、稀疏 NT 等模式，考察 TAGE/带历史预测器对不同历史长度/复杂度模式的学习与分配。
  - 关注：基表 vs 长历史表命中、分配与选择器切换；别名下的退化。

## 次相关：前端取指/宽度（非分支核心）
- `ifuwidth.c`
  - 目的：构造 INT+FPU 指令混合序列，考察 IFU/解码带宽与多类单元并行。
  - 备注：不以分支为核心；可用于与分支类测试对比取指/解码能力上限。

- `aluwidth.c`、`fpuwidth.c`、`renamewidth.c`
  - 目的：测量或施压整数/浮点/重命名宽度与吞吐。
  - 备注：与分支预测无直接关系；用作前端/后端带宽参考基线。

## 低相关/非前端分支类
- `loadlat.c`、`mullat.c`
  - 目的：Load‑to‑Load/乘法延迟链测试。
  - 备注：与分支预测无关；可用于时序/流水线延迟评估。

- `forloop.c`、`matrix.c`
  - 目的：一般性循环/矩阵乘样例。
  - 备注：并非面向前端分支预测的专测，通常不纳入分支对齐验证。

- `time_read.c`
  - 目的：读取平台计时器做时间统计样例。
  - 备注：非性能稳态测量建议；打印/IO 会影响管线表现。

## 对齐与观测建议（摘要）
- 方向预测：逐分支 PC 记录 pred/actual（T/NT）、mispredict、flush 阶段。
- 目标预测：BTB 给出目标与实际目标对比；多分支同块下的覆盖与替换；返回路径使用 RAS 的命中/回滚。
- 取指：I$ 命中、同线双块单拍取回、跨边界气泡；压缩指令导致的边界与对齐。
- 压力点：numBr 上限、fetchBlock 尺寸、组相联与别名、TAGE 表分配与选择器切换。

## 建议的对齐优先级（可从高到低）
1) `brsimple.c` 基线 → `brnum*.c`/`fetchfrag.c` 多分支同块 → `2fetch.c` 同线双块/2‑fetch
2) `rastest.c`/`ras_recursive.c`（RAS）
3) `tage*.c`（历史/复杂模式）
4) 非分支宽度/延迟类仅作对比参考

如需我按你的平台补充“记录字段模板/统计脚本（PC、pred、actual、flush、btb_hit、ras_hit、table、ctr_state）”或把当前分组同步到更上层文档，请告知。
